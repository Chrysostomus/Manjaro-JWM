
#!/bin/bash

#  updated on 01.11.2015 16:11:46

#  This program is free software; you can redistribute it and/or modify
#  it under the terms of the GNU General Public License as published by
#  the Free Software Foundation; either version 2 of the License, or
#  (at your option) any later version.
#  
#  This program is distributed in the hope that it will be useful,
#  but WITHOUT ANY WARRANTY; without even the implied warranty of
#  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#  GNU General Public License for more details.
#  
#  You should have received a copy of the GNU General Public License
#  along with this program; if not, write to the Free Software
#  Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston,
#  MA 02110-1301, USA.
#  

############################################################################################################
# Design based on IceFox script                                                                            #
# Modified, adapted and improved by pekman and excalibur1234                                               #
# Some modifications made by Holmes                                                                        # 
# translation by spylinux					                                           #
# Contact and suggestions: pekman@openmailbox.org (version for Manjaro JWM Edition holmes_holmes@live.com) #
# Freenode: #manjaropek #manjaro-geek #manjaro			                                           #
# Topic discussion 						                                           #
#			http://polr.me/Pacli1			                                           #
#			http://polr.me/Pacli2		                                                   #
#                       http://bit.ly/1NKCL5e 					                           #
#			http://bit.ly/1NKCOOp			                                           #
############################################################################################################

function help_text() {
	less 	<<-EOF
Welcome to Pacli Control Center Shell Packager informations page.
Pacli is an interactive package manager for your command line terminal. It provides an easy user interface and uses Pacman and Yaourt as back ends. Additionally, it uses some Manjaro exclusive commands. Pacli offers you the most common and useful features for managing your packages. Options, which can break your system, are marked in red. 
On the following Help Page all options Pacli offers are described in detail.
HOME SCREEN
Pacli's home screen is split into two parts: 
The upper part focuses on gerneral options and options exclusive to packages from Manjaro's repositories.
The lower part offers Arch User Repository (AUR) management options. 

0 - EXIT PACLI
clear && exit
This will exit Pacli and clear your terminal.

1 - UPDATE SYSTEM
sudo pacman -Syu
This command compares a list of all installed packages with package database on your Manjaro repository mirror/server. If an updated package is available from the Manjaro repositories, it will get downloaded and installed on your system. 

2 - OPTIMIZE MIRRORS
sudo pacman-mirrors -g && sudo pacman -Syy
This command tests your connection to all available Manjaro repository mirrors/servers. The mirror with the best connection is automatically chosen for you. Additionally, the latest package database is downloaded from the chosen Manjaro repository mirror.
If you want to speed up this command: Only test your connection quality to Manjaro mirrors/servers near you. Example: You have noticed the pings to German and French mirrors are always best for you. Then, you can run: "sudo pacman-mirrors -g -c Germany,France"

3 - OPTIMIZE DATABASE
sudo pacman-optimize
This command effectively defragments your Pacman database. It is recommended to CLEAN PACKAGE CACHE before using this option.
On traditional hard drives (HDD) this command can speed up all actions related to Pacman. But it is NOT recommended to use this command on modern solid state hard drives (SSD)!

4 - CLEAN PACKAGE CACHE
paccache -ruk0
paccache -rk2
By default Pacman uses this cache direcoty for downloading packages: /var/cache/pacman/pkg/... . No cached packages get deleted automatically. This enables you to DOWNGRADE PACKAGES, which are broken, without a working internet connection. The package cache of an old and actively used Manjaro installation can become quite large. Clean it to regain space on your root partition.
The first command removes all packages from cache, which are not installed (anymore) on your system. The second command removes all old packages from your cache except the 2 latest versions: The version you have currently installed on your system and the previous version.

5 - SEARCH PACKAGE
pacman -Ss <PACKAGE NAME>
This command does the same as SEARCH PACKAGE, in the repository official. 

6 - PACKAGE INFORMATION
pacman -Si <PACKAGE NAME>
This command displays a lot of information about <PACKAGE NAME>. <PACKAGE NAME> must be a package from the Manjaro repositories.
If you want more information try "pacman -Sii <PACKAGE NAME>". If you look for information from AUR packages try AUR PACKAGE INFORMATION.

7 - INSTALL PACKAGE
sudo pacman -S <PACKAGE NAME>
This option downloads and installs <PACKAGE NAME> on your system. <PACKAGE NAME> must be a package from the Manjaro repositories.

8 -  DETAIL INSTALLED PACKAGES
pacman -Qi <PACKAGE NAME>
This command is intended to make a detailed analysis of the PACKAGE. For exemple: groups, dependence, installed size, etc.

9 – REMOVE PACKAGE
sudo pacman -R <PACKAGE NAME>
This command removes the package from AUR without removing its dependencies.

10 - REMOVE PACKAGE + DEPS
sudo pacman -Rsn <PACKAGE NAME>
This command removes <PACKAGE NAME> including all dependencies, which are no longer needed by other packages, from your system. A copy of <PACKAGE NAME> will be kept in your package cache. Please note that folders created by the program <PACKAGE NAME> will not get removed from your system. Look for such folders in these places and remove them manually:
~
~/.config/
~/.local/

11 - LIST ORPHAN PACKAGES
pacman -Qqdt
This option lists all orphaned packages on your system. Orphaned packages are old dependencies (packages not explicitly installed by you), which were never removed from your system. 
Answer with "y" or "n" to remove all listed orphaned packages or not.

12 - REMOVE ORPHAN PACKAGES
sudo pacman -Rns $(pacman -Qqdt)
As the months turn into years since the initial install of our Arch based installations, (isn't the rolling release system wonderful) we tend to accumulate orphan packages that are basically just useless clutter on our HDDs. 

13 - LOCAL LIST
pacman -Ql  <PACKAGE NAME>
This command lists all files and their install directory contained in <PACKAGE NAME>. <PACKAGE NAME> must be installed on your system.

14 - DEPENDENCIES TREE
pactree <PACKAGE NAME>
This command will display a complete tree of all dependencies of <PACKAGE NAME>.
Attention: The dependency tree can be quite long an complex for higher level packages such as "firefox".

15 - INSTALLED PACKAGES
pacman -Qet
This option lists all packages from Manjaro's repositories installed on your system.

16 - FIX ERRORS
sudo rm -f /var/lib/pacman/db.lck && sudo pacman-mirrors -g && sudo pacman -Syyuu
This long command attempts to fix the most common issues Manjaro users have with Pacman: 
First, it removes Pacman's database lock.  Then, it does the same as OPTIMIZE MIRRORS: It will search for working and good Manjaro repository mirrors/servers.  Finally, the last command forces a redownload of the latest package database from the best Manjaro repository mirror. Then, all your installed packages are checked against this latest package database. If an updated package is available from the Manjaro repositories, it will get downloaded and installed on your system. If an installed package is newer than the same package in the Manjaro repositories, the installed package will get downgraded. This behavior ensures your packages are always in sync with the Manajro repositories, even if you have just switched the Manjaro mirror or switched from unstable to stable branch. Attention: Only run this command when no other Pacman instance (e.g. Pacman, Yaourt, Pamac, Octopi, PacmanXG4, ...) is running.

17 - INFORMATION
Display this help page.

18 - UPDATE AUR
yaourt -Syyuua
This command does the same as UPDATE SYSTEM, but with one excpetion: It also updates all packages from Arch User Repository (AUR), which have an updated PKGBUILD file. Attention: When a new version of an AUR package is available, often the PKGBUILD file is not updated. If you want to install the latest version of an AUR package, (re-)install it with INSTALL FROM AUR. If you want to install the latest version of all AUR packages do "yaourt -Syyuua --devel".

19 - SEARCH ON AUR
yaourt <PACKAGE NAME>
This command does the same as SEARCH PACKAGE, but additionally it searches the Arch User Repository (AUR). 

20 - INSTALL FROM AUR
yaourt -S <PACKAGE NAME>
This command does the same as INSTALL PACKAGE. Additionally, AUR packages can be installed.

21 -  REMOVE FROM AUR
yaourt -R <PACKAGE NAME>
This command removes the package from AUR without removing its dependencies.

22- REMOVE FROM AUR + DEPS 
yaourt -Rsn  <PACKAGE NAME>
This command removes <PACKAGE NAME> including all dependencies, which are no longer needed by other packages, from your system. A copy of <PACKAGE NAME> will be kept in your package cache. Please note that folders created by the program <PACKAGE NAME> will not get removed from your system. Look for such folders in these places and remove them manually:
~
~/.config/
~/.local/

23 - INSTALLED FROM AUR
pacman -Qem
This command lists all installed packages, which are from the AUR or which were manually installed.
To exit this Help Page, press "q".
	EOF
}

# set colors
RED='\e[41m'
BLUE='\e[44m'
ORANGE='\e[46m'
NC='\e[0m'
    while true; do
    clear
    echo ""
    echo -e "                     $NC Pacli Control Center Shell Packager $NC "
    echo ""
    echo -e "                        $NC ::WARNING! USE WITH CAUTION:: $NC"
    echo -e " ┌────────────────────────────────────────────────────────────────────────────┐"
    echo -e " │  $NC  1 $NC  Update System                       $NC  2 $NC  Optimize Mirrors          │"
    echo -e " │  $NC  3 $NC  Optimize Database                   $NC  4 $NC  Clean Package Cache       │"
    echo -e " │  $NC  5 $NC  Search Package                      $NC  6 $NC  Package Information       │"
    echo -e " │  $NC  7 $NC  Install Package                     $NC  8 $NC  Detail Installed Packages │"
    echo -e " │  $NC  9 $NC  Remove Package                      $NC 10 $NC  Remove Package + Deps     │"
    echo -e " │  $NC 11 $NC  List Orphan Packages                $NC 12 $NC  Remove Orphan Packages    │"
    echo -e " │  $NC 13 $NC  Local List                          $NC 14 $NC  Dependencies Tree         │"
    echo -e " │  $NC 15 $NC  Installed Packages                  $NC 16 $NC  Fix Errors                │"
    echo -e " │  $NC 17 $NC  Information					                      │"
    echo " └────────────────────────────────────────────────────────────────────────────┘"
    echo ""
    echo " ┌────────────────────────────────────────────────────────────────────────────┐"
    echo -e " │  $NC 18 $NC  Update AUR                          $NC 19 $NC  Search on AUR             │"
    echo -e " │  $NC 20 $NC  Install from AUR                    $NC 21 $NC  Remove from AUR           │"
    echo -e " │  $NC 22 $NC  Remove from AUR + Deps              $NC 23 $NC  Installed from AUR        │"
    echo " └────────────────────────────────────────────────────────────────────────────┘"
    echo ""
    echo -e "            $NC Select a number and press [Enter]$NC $NC - 0 Exit Pacli$NC"
    echo ""
    read choix
    case $choix in
        1)
            echo
            sudo pacman -Syyuu
            echo ""
            echo -e "$NC Your system is updated. To return to Pacli press [Enter] $NC"
            read
            ;;
        2)
            echo
            sudo pacman-mirrors -g && sudo pacman -Syy
            echo ""
            echo -e "$NC Fastest mirror chosen. To return to Pacli press [Enter] $NC"
            read
            ;;
        3)
            echo
            sudo pacman-optimize
            echo ""
            echo -e "$NC Pacman Database optimized. To return to Pacli press [Enter] $NC"
            read
            ;;
        4)
            echo
            paccache -ruk0
	    paccache -rk3
            echo ""
            echo -e "$NC Unneeded and old package versions removed. To return to Pacli press [Enter] $NC"
            read
            ;;
        5)
            echo ""
            echo "Do you want to search a package? Put the name below and press [Enter]"
            echo ""
            read searchpackage
            pacman -Ss $searchpackage
            echo ""
            echo -e "$NC The search is complete. To return to Pacli press [Enter] $NC"
            read
            ;;
        6)
            echo ""
            echo "Do you want to check specific information about a package? Put the name below and press [Enter]"
            echo ""
            read searchpackage
            pacman -Si $searchpackage
            echo ""
            echo -e "$NC The search for information ended. To return to Pacli press [Enter] $NC"
            read 
			;;
        7)
            echo ""
            echo "Do you want to install a package? Put the name below and press [Enter]"
            echo ""
            read installpackage
            sudo pacman -S $installpackage
            echo ""
            echo -e "$NC The package installation is finished. To return to Pacli press [Enter] $NC"
            read
            ;;
        8)
            echo ""
            echo "Do you want to check specific information about a package?  Put the name below and press [Enter]"
            echo ""
            read searchpackage
            pacman -Qi $searchpackage
            echo ""
            echo -e "$NC All information displayed. To return to Pacli press [Enter] $NC"
            read
            ;;
        9)
            echo ""
            echo "Do you want to uninstall a single package? All Dependencies will be kept as orphans. Put the name below and press [Enter]"
            echo ""
            read uninstallpackage
            sudo pacman -R $uninstallpackage
            echo ""
            echo -e "$NC Action completed. To return to Pacli press [Enter] $NC"
            read
            ;;
        10)
			echo ""
            echo "Do you want to uninstall a package including all its dependencies? Put the name below and press [Enter]"
            echo ""
            read uninstallpackage
            sudo pacman -Rsn $uninstallpackage
            echo ""
            echo -e "$NC Action completed. To return to Pacli press [Enter] $NC"
            read
            ;;
        11)
            echo ""
            echo "Display all orphan packages"
            pacman -Qqdt
            echo ""
            echo -e "$NC Checking completed. To return to Pacli press [Enter] $NC"
            read        
            ;;
        12)
            echo ""
            echo "Do you want to uninstall orphan packages including all its dependencies? Press [Enter] to continue."
            echo ""
            read uninstallpackage
            sudo pacman -Rns $(pacman -Qqdt)
            echo ""
            echo -e "$NC Task completed. To return to Pacli press [Enter] $NC"
            read
            ;;
        13)
            echo ""
            echo "Do you want to list all local files of a package? Put the package name below and press [Enter]"
            echo ""
            read Packcage
            pacman -Ql $Packcage
            echo ""
            echo -e "$NC Task completed. To return to Pacli press [Enter] $NC"
            read 
            ;;
        14)
            echo ""
            echo "Do you want to display the dependency tree of a package? Put the package name below and press [Enter]"
            echo ""
            read Packcage
            pactree $Packcage
            echo ""
            echo -e "$NC Task completed. To return to Pacli press [Enter] $NC"
            read
            ;;
        15)
            echo ""
            pacman -Qet
            echo ""
            echo -e "$NC Task completed. To return to Pacli press [Enter] $NC"
            read     
            ;;
            
        16)
            echo ""
            sudo rm -f /var/lib/pacman/db.lck && sudo pacman-mirrors -g && sudo pacman -Syy
            echo ""
            echo -e "$NC All Pacman errors fixed. Now press [Enter] $NC"
            read     
            ;;
        17)
            echo
            help_text
            echo
            ;;
        18)
            echo ""
            echo "To update AUR packages press [Enter]. Then provide your user password."
            yaourt -Syyuua
            echo ""
            echo -e "$NC There is nothing else to do. To return to Pacli press [Enter] $NC"
            read     
            ;;
        19)
            echo ""
            echo "Do you want to search a package in the AUR? Press [Enter] to continue."
            echo ""
            read searchpackage
            yaourt -Ss $searchpackage 
            echo ""           
            echo -e "$NC Serch completed. To return to Pacli press [Enter] $NC"
            read
            ;;
        20)
            echo ""
            echo "Do you want to install a package from the AUR? Put the correct package name below and press [Enter]"
            echo ""
            read Packcage
            yaourt -S $Packcage
            echo ""
            echo -e "$NC Task completed. To return to Pacli press [Enter] $NC"
            read 
            ;;
        21)
            echo ""
            echo "Do you want to remove a single package from the AUR? All Dependencies will be kept as orphans. Put the correct name below and press [Enter]"
            echo ""
            read Packcage
            yaourt -R $Packcage
            echo ""
            echo -e "$NC Task completed. To return to Pacli press [Enter] $NC"
            read
            ;;
        22)
            echo ""
            echo "Do you want to remove a package from AUR including all its dependencies? Put the correct name below and press [Enter]"
            echo ""
            read Packcage
            yaourt -Rsn $Packcage
            echo ""
            echo -e "$NC Task completed. To return to Pacli press [Enter] $NC"
            read
            ;;
        23)
            echo ""
            pacman -Qem
            echo ""
            echo -e "$NC Task completed. To return to Pacli press [Enter] $NC"
            read     
            ;;
        0)
            clear && exit
            read
            ;;
        *)
            echo -e "$RED Wrong option $NC"
            echo "Wait and try again later..."
            echo ""
            sleep 3
            clear
            ;;
    esac
    done
fi
